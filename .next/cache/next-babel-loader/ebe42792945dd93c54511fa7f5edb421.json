{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport AV from 'leancloud-storage';\nimport dayjs from 'dayjs';\nimport React, { useState, useEffect } from 'react';\nimport { getMenusList } from 'src/service/menu';\nimport { getProfileList } from 'src/service/profile';\nimport { getMyUserInfo } from 'src/service/user';\nimport styles from './index.module.scss';\nimport Nav from '../Nav';\nComponents.defaultProps = {\n  onChange: function onChange() {}\n};\n\nfunction Components(props) {\n  var _useState = useState(null),\n      menus = _useState[0],\n      setmenus = _useState[1];\n\n  var _useState2 = useState(null),\n      profile = _useState2[0],\n      setprofile = _useState2[1];\n\n  var _useState3 = useState(null),\n      curUserInfo = _useState3[0],\n      setcurUserInfo = _useState3[1];\n\n  var handleInit = function handleInit() {\n    return _regeneratorRuntime.async(function handleInit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(getData('CMS_Menus', getMenusList, setmenus));\n\n          case 3:\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(getData('CMS_Profile', getProfileList, setprofile));\n\n          case 5:\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(getData('CMS_UserInfo', getMyUserInfo, setcurUserInfo));\n\n          case 7:\n            _context.next = 12;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](0);\n            console.error(_context.t0);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var getData = function getData(keyname, func, setFunc) {\n    var local_data, local_time, res;\n    return _regeneratorRuntime.async(function getData$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // 获取菜单\n            local_data = localStorage.getItem(keyname);\n            local_time = Number(localStorage.getItem(\"\".concat(keyname, \"_time\")));\n            local_data && setFunc(JSON.parse(local_data));\n\n            if (!(local_data && local_time + 5 * 60 * 1000 > Date.now())) {\n              _context2.next = 7;\n              break;\n            }\n\n            setFunc(JSON.parse(local_data));\n            _context2.next = 11;\n            break;\n\n          case 7:\n            _context2.next = 9;\n            return _regeneratorRuntime.awrap(func());\n\n          case 9:\n            res = _context2.sent;\n\n            if (res) {\n              setFunc(JSON.parse(JSON.stringify(res)));\n              localStorage.setItem(keyname, JSON.stringify(res));\n              localStorage.setItem(\"\".concat(keyname, \"_time\"), Date.now());\n            }\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    handleInit();\n  }, []);\n  useEffect(function () {\n    props.onChange && props.onChange({\n      menus: menus,\n      profile: profile,\n      userinfo: curUserInfo\n    });\n  }, [menus, profile, curUserInfo]);\n  return __jsx(\"div\", {\n    className: styles.container\n  }, profile && profile.github ? __jsx(\"a\", {\n    target: \"_blank\",\n    className: \"github-corner\",\n    \"aria-label\": \"View source on Github\",\n    href: profile.github\n  }, __jsx(\"svg\", {\n    width: \"80\",\n    height: \"80\",\n    viewBox: \"0 0 250 250\",\n    style: {\n      fill: '#151513',\n      color: '#fff',\n      position: 'absolute',\n      top: 0,\n      border: 0,\n      right: 0\n    },\n    \"aria-hidden\": \"true\"\n  }, __jsx(\"path\", {\n    d: \"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\"\n  }), __jsx(\"path\", {\n    d: \"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\",\n    fill: \"currentColor\",\n    style: {\n      transformOrigin: '130px 106px'\n    },\n    className: \"octo-arm\"\n  }), __jsx(\"path\", {\n    d: \"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\",\n    fill: \"currentColor\",\n    className: \"octo-body\"\n  }))) : null, menus && profile && __jsx(Nav, {\n    menus: menus.value,\n    profile: profile,\n    userinfo: curUserInfo\n  }), __jsx(\"div\", {\n    className: styles.body\n  }, props.children), profile && __jsx(\"footer\", {\n    className: styles.footer\n  }, __jsx(\"div\", {\n    className: styles.footer_content\n  }, __jsx(\"img\", {\n    src: profile.logo,\n    alt: \"\",\n    className: styles.logo\n  }), __jsx(\"p\", {\n    className: styles.copyright\n  }, profile.copyright)), __jsx(\"div\", {\n    className: styles.footer_powerby\n  }, __jsx(\"p\", {\n    className: styles.title\n  }, \"Powered By \", __jsx(\"a\", {\n    href: process.env.brandLink,\n    className: \"link\",\n    target: \"_blank\"\n  }, __jsx(\"i\", {\n    className: \"iconfont icon-github\"\n  }), \"\\u300C\", process.env.brandName, \"\\u300D\"), \".\"))));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}